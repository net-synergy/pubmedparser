<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2022-06-20 Mon 19:03 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Pubmed parser</title>
<meta name="author" content="David R. Connell" />
<meta name="generator" content="Org Mode" />
<style>
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>

<style>
  pre.src {
    background-color: #FAFAFA;
  }

  div, p {
    margin: auto;
    max-width: 48em;
    line-height: 1.4;
  }

  p {
    font-size 11pt;
    font-weight: normal;
    color: #222222;
    text-indent: 4ex;
  }

  /* Treat underline as bold italic. Bit of a hack, bold and
  italicized is being ignored by pandoc when exporting to docx so
  using underline to identify text to manually change style to
  emphasize in word. But the intended effect is actually italic and
  bold so using this. */
  b, span.underline {
    font-family: sans-serif;
    font-weight: bold;
    font-style: italic;
    color: black;
    text-decoration: none;
  }

  code {
    color: black;
    font-weight: 600;
  }

  h1, h2, h3, h4, h5, h6 {
    color: black;
    font-family: sans-serif;
    margin-bottom: 0.5ex;
    margin-top: 3ex;
  }

  h2 {
    font-size: 24pt;
  }

  h3 {
    font-size: 14pt;
  }

  a:link {
    color: #0031a9;
  }

  a:visited {
    color: #673AB7;
  }

  pre.src:before {
    font-family: sans-serif;
    font-weight: bold;
    font-size: 12;
  }
</style>
</head>
<body>
<div id="content" class="content">
<h1 class="title">Pubmed parser</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#structure-file">1. Structure file</a></li>
<li><a href="#org7225b8f">2. <span class="todo TODO">TODO</span> Example: creating a neo4j DB</a></li>
</ul>
</div>
</div>
<p>
Read XML files and pull out selected values.
Values to collect are determined by paths found in a <a href="#structure-file">structure file</a>.
The structure file also includes a key which associates the values with a parent element and names, which determine which file to place the elements in.
</p>

<p>
Files can be passed as either gzipped or uncompressed XML files or from standard in.
</p>

<p>
For more info on Pubmed's XML files see: <a href="https://dtd.nlm.nih.gov/ncbi/pubmed/doc/out/190101/index.html">pubmed_190101.dtd.</a>
</p>

<p>
Usage:
</p>
<div class="org-src-container">
<pre class="src src-sh">xml_read --cache-dir=cache --structure-file=structure.yml <span style="color: #FFAB91;">\</span>
    data/*.xml.gz
</pre>
</div>

<p>
The cache directory is where the results are stored.
</p>

<p>
Build:
Requires <code>zlib</code>
</p>
<div class="org-src-container">
<pre class="src src-sh">make all
</pre>
</div>

<p>
or using nix:
</p>
<div class="org-src-container">
<pre class="src src-sh">nix shell <span style="color: #FFAB91;">"gitlab:DavidRConnell/pubmedparser"</span>
</pre>
</div>

<p>
Has a runtime dependency on <code>cat</code> found in <code>coreutils</code>.
</p>

<div id="outline-container-structure-file" class="outline-2">
<h2 id="structure-file"><span class="section-number-2">1.</span> Structure file</h2>
<div class="outline-text-2" id="text-structure-file">
<p>
The structure file is a YAML file containing key-value pairs for different tags and paths.
There are four required keys: <code>root</code>, <code>key</code>, <code>key_features</code>, and <code>nodes</code>.
<code>Root</code> provide the top-level tag, in the case of the pubmed files this will be <code>PubmedArticleSet</code>.
</p>

<div class="org-src-container">
<pre class="src src-sh">root: <span style="color: #FFAB91;">"PubmedArticleSet"</span>
</pre>
</div>

<p>
Only tags below the root tag will be considered.
</p>

<p>
<code>Key</code> is a reference tag.
In the pubmed case all data is with respect to a publication, so the key should identify the publication the values are linked to.
The <code>PMID</code> tag is a suitable candidate.
</p>

<div class="org-src-container">
<pre class="src src-sh">key: <span style="color: #000000;">{</span>
  Publication: <span style="color: #FFAB91;">"/PubmedArticle/MedlineCitation/PMID"</span>
<span style="color: #000000;">}</span>
</pre>
</div>

<p>
Unlike <code>root</code>, the value of <code>key</code> should be a map.
In the example above, <code>key</code> is named publication and it's value is an XML path.
The name is used to determine the file to write <code>PMID</code> values to.
This file acts as a reference for all publications seen, even those for which no other value was found.
Key's value is a path indicating where to find the desired tag in the XML hierarchy.
All paths start after the root.
</p>

<p>
Both <code>key_features</code> and <code>nodes</code> determine the other values to collect.
The <code>read_xml</code> program does not distinguish between them, but it is useful for post-processing the data if we keep them separate.
<code>Key_features</code> is for values that are apart of the key's node.
For instance, the date of publication is specific to the publication, all publications have one, and only one, publication date.
<code>Nodes</code> handles other values that characterize a publication but are can have any number (including 0) of instances, such as references and authors.
These make up distinct node type (i.e. a given author is a node of type author which can be connected to various other nodes such as the publications that author contributed to).
</p>

<div class="org-src-container">
<pre class="src src-sh">key_features: <span style="color: #000000;">{</span>
  Year: <span style="color: #FFAB91;">"/PubmedArticle/MedlineCitation/Article/Journal/JournalIssue/PubDate/Year"</span>,
  Language: <span style="color: #FFAB91;">"/PubmedArticle/MedlineCitation/Article/Language"</span>
<span style="color: #000000;">}</span>

nodes: <span style="color: #000000;">{</span>
  Author: <span style="color: #FFAB91;">"/PubmedArticle/MedlineCitation/Article/AuthorList/Author/{LastName,ForeName}"</span>,
  Grant: <span style="color: #FFAB91;">"/PubmedArticle/MedlineCitation/Article/GrantList/Grant/GrantID"</span>,
  Chemical: <span style="color: #FFAB91;">"/PubmedArticle/MedlineCitation/ChemicalList/Chemical/NameOfSubstance/@UI"</span>,
  Qualifier: <span style="color: #FFAB91;">"/PubmedArticle/MedlineCitation/MeshHeadingList/MeshHeading/QualifierName/@UI"</span>,
  Descriptor: <span style="color: #FFAB91;">"/PubmedArticle/MedlineCitation/MeshHeadingList/MeshHeading/DescriptorName/@UI"</span>,
<span style="color: #000000;">}</span>

edges: <span style="color: #000000;">{</span>
    Reference: <span style="color: #FFAB91;">"/PubmedArticle/PubmedData/ReferenceList/Reference/ArticleIdList/ArticleId/[@IdType='pubmed']"</span>
<span style="color: #000000;">}</span>
</pre>
</div>

<p>
In the above example there is some special syntax.
For <code>author</code> multiple values are returned each time the <code>author</code> tag is found.
This is expressed by using the <code>{child_tag1,child_tag2,...}</code> notation.
Each child tag under the parent tag is collected and returned in a single row, represented multiple node features.
This notation prevents mismatches between features of a given node if any tags are missing.
In the case a tag is missing an empty string is printed.
</p>

<p>
To get an attribute from a tag, the <code>@attribute</code> notation is used&#x2014;as in the <code>chemical</code> node.
Whenever a path ends with an attribute <code>xml_read</code> will collect both the attribute and tag value.
</p>

<p>
Lastly, <code>[@attribute='value']</code> filters for attributes with the supplied values.
In the case of <code>reference</code> above this will ensure all references are identified by <code>PMID</code> as opposed to other IDs, such as DOI, so <code>references</code> can be linked with <code>publication</code> nodes.
</p>

<p>
Notice that <code>Reference</code> is an edge because a reference is a link between two publications. The <code>read_xml</code> executable does not differentiate between the two, the distinction is for the benefit of post-processing using the same structure template.
</p>

<p>
This example structure file can be found in the example directory of this project at: <a href="./example/structure.yml">./example/structure.yml</a>
</p>
</div>
</div>

<div id="outline-container-org7225b8f" class="outline-2">
<h2 id="org7225b8f"><span class="section-number-2">2.</span> <span class="todo TODO">TODO</span> Example: creating a neo4j DB</h2>
<div class="outline-text-2" id="text-2">
<p>
Move <code>example/creating_graphs.sh</code> into this file.
</p>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: David R. Connell</p>
<p class="date">Created: 2022-06-20 Mon 19:03</p>
</div>
</body>
</html>
